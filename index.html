<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Workout Logger (Local)</title>
  <script>
    window.ASSET_VERSION = "2024-03-01-12-34-56";
    window.withAssetVersion = (path) => {
      const separator = path.includes("?") ? "&" : "?";
      return `${path}${separator}v=${window.ASSET_VERSION}`;
    };
    const stylesheet = document.createElement("link");
    stylesheet.rel = "stylesheet";
    stylesheet.href = window.withAssetVersion("styles.css");
    document.head.appendChild(stylesheet);
  </script>
  <noscript>
    <link rel="stylesheet" href="styles.css?v=2024-03-01-12-34-56">
  </noscript>
</head>
<body>
  <div class="topbar">
    <div class="topbar-inner">
      <div class="brand">
        <div class="dot"></div>
        <h1>Workout Logger <span class="muted">¬∑ local (IndexedDB)</span></h1>
      </div>

      <div class="tabs" role="tablist">
        <button class="tab active" data-tab="log" role="tab" aria-selected="true">Logging</button>
        <button class="tab" data-tab="config" role="tab" aria-selected="false">Config</button>
        <button class="tab" data-tab="history" role="tab" aria-selected="false">History</button>
      </div>

      <div class="actions">
        <button class="btn" id="exportBtn">Export</button>
        <label class="btn" for="importFile" style="cursor:pointer">Import</label>
        <input id="importFile" type="file" accept="application/json" style="display:none" />
      </div>
    </div>
  </div>

  <div class="wrap">
    <!-- LOGGING PAGE -->
    <section id="page-log" class="grid cols2" style="margin-top:14px">
      <div class="card">
        <div class="row between">
          <h2 class="h2">Today‚Äôs workout logger</h2>
          <span id="dbStatus" class="pill warn">Loading‚Ä¶</span>
        </div>
        <div class="divider"></div>

        <div class="row">
          <div class="field">
            <label for="logDate">Date</label>
            <div class="date-picker">
              <input id="logDate" type="date" />
              <button class="btn icon-btn" type="button" id="logDatePickerBtn" aria-label="Open date picker">üìÖ</button>
            </div>
            <div class="sub">Pick any date.</div>
          </div>

          <div class="field">
            <label for="workoutType">Workout type</label>
            <select id="workoutType"></select>
            <div class="sub">Changing this re-renders the exercise log layout.</div>
          </div>
        </div>

        <div class="divider"></div>

        <div class="row">
          <div class="field" style="flex: 1 1 100%">
            <label for="sessionComment">Session comment</label>
            <textarea id="sessionComment" placeholder="How did it feel? Anything notable?"></textarea>
          </div>
        </div>

        <div class="divider"></div>

        <div class="row between">
          <div class="muted">Exercises for selected workout</div>
          <div class="right" style="gap:8px">
            <button class="btn" id="clearFormBtn" title="Clears inputs (does not delete history)">Clear form</button>
            <button class="btn ok" id="saveSessionBtn">Save session</button>
          </div>
        </div>

        <div id="exerciseList" class="grid" style="margin-top:12px"></div>
        <div id="sessionSummary" class="session-summary"></div>
      </div>

      <div class="grid">
        <div class="card">
          <h2 class="h2">Quick tips</h2>
          <div class="muted">
            <ul class="tips">
              <li><b>Reps grid</b>: enter reps per set (Set 1‚Ä¶Set N). Leave blank if you didn‚Äôt do that set.</li>
              <li><b>Sets done</b>: auto-calculated live from filled rep cells. If you type it manually, it won‚Äôt be overwritten until you clear it.</li>
              <li><b>Pain</b>: 0‚Äì5 where 0 = none, 5 = stop-worthy.</li>
              <li><b>Rest</b>: minutes (e.g. 2.5). Defaults come from config; you can override.</li>
            </ul>
          </div>
        </div>

        <div class="card">
          <h2 class="h2">Data & privacy</h2>
          <div class="muted" style="line-height:1.6">
            Data is stored locally in <b>IndexedDB</b> in this browser. Use <b>Export</b> occasionally to back up.
            Import restores config + sessions.
            <div class="divider"></div>
            <div class="row between" style="align-items:center">
              <div>
                <div><b>Auto backup</b>: stored locally after saves.</div>
                <div id="backupStatus" class="sub">No backup yet.</div>
              </div>
              <button class="btn small" id="downloadBackupBtn">Download backup</button>
            </div>
            <div class="divider"></div>
            <div class="kpi" id="kpis"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- CONFIG PAGE -->
    <section id="page-config" style="display:none; margin-top:14px">
      <div class="card">
        <div class="row between">
          <h2 class="h2">Config</h2>
          <div class="right" style="gap:8px">
            <button class="btn" id="addRowBtn">Add row</button>
            <button class="btn" id="addWorkoutBtn">Add workout</button>
            <button class="btn primary" id="saveConfigBtn">Save config</button>
            <button class="btn danger" id="resetDefaultsBtn">Reset defaults</button>
          </div>
        </div>

        <div class="sub">
          Reorder exercises with <b>‚Üë / ‚Üì</b> on iPhone, or drag via the handle on desktop.
          Order here is the order used on the Logging page.
        </div>

        <div class="divider"></div>

        <div class="table-wrap">
          <table id="configTable">
            <thead>
              <tr>
                <th class="w-move">Move</th>
                <th>Exercise</th>
                <th class="w-num">Sets</th>
                <th class="w-num">RepLow</th>
                <th class="w-num">RepHigh</th>
                <th class="w-num">Rest (min)</th>
                <th class="w-actions"></th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>

        <div class="sub" style="margin-top:10px">
          Tip: Use consistent workout names (e.g. ‚ÄúWorkout 1 ‚Äì Full Body‚Äù) so grouping behaves as expected.
        </div>
      </div>
    </section>

    <!-- HISTORY PAGE -->
    <section id="page-history" style="display:none; margin-top:14px">
      <div class="card">
        <div class="row between">
          <h2 class="h2">History</h2>
          <div class="right" style="gap:8px">
            <button class="btn" id="refreshHistoryBtn">Refresh</button>
            <button class="btn danger" id="deleteAllBtn" title="Deletes all sessions (config kept)">Delete all sessions</button>
          </div>
        </div>
        <div class="sub">All saved sessions from the Logging page.</div>
        <div class="divider"></div>

        <div class="row">
          <div class="field">
            <label for="historyFilterWorkout">Filter by workout</label>
            <select id="historyFilterWorkout"></select>
          </div>
          <div class="field">
            <label for="historySearch">Search (exercise/comment)</label>
            <input id="historySearch" type="text" placeholder="e.g. pull-up, knee, AMRAP" />
          </div>
        </div>

        <div class="divider"></div>
        <div id="historyList" class="grid" style="gap:12px"></div>
      </div>
    </section>
  </div>

  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <script>
    const appScript = document.createElement("script");
    appScript.src = window.withAssetVersion("app.js");
    document.body.appendChild(appScript);
  </script>
  <noscript>
    <script src="app.js?v=2024-03-01-12-34-56"></script>
  </noscript>
</body>
</html>
